language:
  - java
  - scala

before_install: sudo pip install codecov

script: sbt clean coverage test
jdk:
  - oraclejdk7
scala:
  - 2.11.4

cache:
  directories:
    - $HOME/.m2
    - $HOME/.ivy2
git:
  depth: 1

env:
  global:
  - secure: dJf3177mgt0zAy7tnruPH1/B8tAgSOd4BWGGRj7ZbetwiQul0QCKpHOfJGsDdG3u17ypjj8lpFnAoPAkEKyivlLDRacVF3ty5vjgPWF0t1H0gBIQXQ4IbOxxB0hZECVCTUipe7YFi5QCj7Wt9NpjGGbsTSMC/GzhCKPYk4M6m6Q=
  - secure: HckspPZWxwbasFWeBeWqPrt21WPE+9V21yNC+0uuqUTc5Db+wzfr1IMZhFZa3nao1oePuFEdH+52JkhRm5l+iMhqyfis9nwFH2Vttuw0qmiDWW/IHhX9P18lttsDVNd7uWZ00fetUzabaRuUMLMP1V0hC1HuJgHtsyPxbZBfNBc=
  
after_success: 
 - codecov
   ## publish to snapshot repo
 - 'if [[ $TRAVIS_BRANCH == "master" && $TRAVIS_PULL_REQUEST == "false" && $TRAVIS_TAG == "" ]];then
   sbt publish;
   fi'
   ## publish to release repo
 - 'if [[ $TRAVIS_TAG != "" && $TRAVIS_PULL_REQUEST == "false" ]];then
   sbt publish;
   fi'
 
before_deploy:
 - sbt assembly packArchive travis_deploy
 
deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: NYY003Bum6aL5h5Au8nCEY51lnDcsCErvmfzpIh0CWNY4UKnADSXkJPdureAf3OR7eMFmQxMi1rL2MQtOjlCWgaPO4TmEJrXB3vMZTTyj1COst5WIQV8S/BbgDzKFEP9zuRNbMXdRJqf0rEhIrKPagXkOTDaGNijmjCCh5y62M4=
  file: 'target/binary.gearpump.tar.gz'
  on:
    repo: intel-hadoop/gearpump
    tags: true
    all_branches: true
